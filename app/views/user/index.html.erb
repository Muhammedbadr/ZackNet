<% @users.each do |user| %>
  <div class="card mb-2 shadow-sm rounded-lg">
    <div class="card-body d-flex justify-content-between align-items-center">
      <div class="d-flex align-items-center gap-2">
        <% if user.avatar.attached? %>
          <img src="<%= url_for(user.avatar) %>" class="rounded-circle " alt="<%= user.username %>'s Avatar" style="width: 50px; height: 50px; object-fit: cover;">
        <% else %>
          <i class="bi bi-person-circle fs-1 text-primary "></i>
        <% end %>
        <h5 class="card-title mb-0"><%= user.username %></h5>
      </div>
      
      <% # Check if the current user is following this user %>
      <% relationship = Relationship.find_by(follower_id: current_user.id, followed_id: user.id) %>

      <% if relationship %> 
        <form action="/user/unfollow" method="post">
          <input type="hidden" name="followed_id" value="<%= user.id %>">
          <button type="submit" class="btn btn-danger btn-sm">Unfollow</button>   
        </form>
      <% else %>
        <form action="/user/follow" method="post">
          <input type="hidden" name="followed_id" value="<%= user.id %>">
          <button type="submit" class="btn btn-primary btn-sm">Follow</button>   
        </form>
      <% end %>
    </div>
  </div>
<% end %>
